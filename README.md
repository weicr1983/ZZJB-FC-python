# 重装机兵FC游戏

这是一个使用Python和Pygame制作的FC风格重装机兵游戏，实现了角色移动、地图切换、遇敌系统和战斗系统等核心功能。

## 目录结构

```
├── assets/                 # 游戏资源文件夹
│   ├── audio/              # 音频资源
│   │   ├── bgm/            # 背景音乐
│   │   └── se/             # 音效
│   ├── images/             # 图片资源
│   │   ├── battle_characters/    # 战斗角色图片
│   │   ├── characters/           # 角色行走动画图片
│   │   ├── enemy/                # 敌人图片
│   │   └── ui/                   # UI地图界面资源
│   └── sounds/             # 声音文件
├── maps/                   # 地图数据文件
│   ├── 世界地图.json       # 世界地图数据
│   ├── 拉多.json           # 拉多城镇地图数据
│   └── 拉多_家.json        # 拉多家中地图数据
├── map_png/                # 地图图片文件
├── battle_system.py        # 战斗系统模块
├── battle_test.py          # 战斗系统测试文件
├── game.py                 # 游戏主程序
├── main.py                 # 旧版主程序（已废弃，多人版本）
├── map_editor.py           # 地图编辑器
├── pixel_editor.py         # 像素编辑器
└── README.md               # 说明文档
```

## 核心功能
## game.py
1. **角色移动系统**：
   - 实现了8步平滑移动效果，支持上下左右四个方向
   - 坐标更新机制：仅在角色完全走完一个瓦片格子后更新窗口标题栏显示的坐标
   - 移动状态管理：通过steps_remaining、moving_state和just_completed_tile等状态变量精确控制移动过程

2. **地图切换系统**：
   - 支持不同地图之间的无缝切换，包括世界地图和城镇地图
   - 切换点检测：仅在角色完全进入瓦片格子后触发地图切换，避免中途切换
   - 标题更新机制：地图切换后立即更新窗口标题栏显示的当前地图信息

3. **遇敌系统**：
   - 在行走过程中有概率遇到敌人，进入战斗界面
   - 优化机制：切换地图的格子不会触发遇敌，优先处理地图切换逻辑
   - 遇敌概率：基于地图配置和行走步数的随机遇敌系统

4. **战斗系统**：
   - 实现了回合制战斗，支持角色和敌人的攻击、防御等操作
   - 战斗角色和敌人的属性管理
   - 战斗结果判定和战斗动画效果

5. **地图编辑器**：
   - 可用于创建和编辑游戏地图
   - 支持地图瓦片编辑、切换点配置和遇敌设置
## map_editor.py
1. **地图瓦片编辑**：
   - 可用于编辑游戏地图的可视化界面
   - 支持绘制和删除地图瓦片，以及配置地图属性（如切换点、遇敌设置等）
## pixel_editor.py
1. **像素编辑器**：
   - 可用于编辑游戏地图的像素级细节
   - 主要功能按钮有加载地图、保存地图、绘制像素点、删除像素点、配置地图属性等
   - 作者可以使用这个工具创建自定义的地图和人物图片。

## 如何运行游戏

1. 确保已安装Python 3和Pygame库
2. 运行游戏：

```bash
python game.py
```

## 控制说明

- **W键/上方向键**：向上移动
- **S键/下方向键**：向下移动
- **A键/左方向键**：向左移动
- **D键/右方向键**：向右移动

## 地图系统

游戏使用JSON格式存储地图数据，主要包括：
- 地图瓦片数据：定义地图的视觉外观
- 地图尺寸信息：地图的宽高（以瓦片为单位）
- 地图切换点配置：定义地图间的切换位置和目标地图
- 遇敌设置：控制地图上的遇敌概率和敌人类型

地图文件位于 `maps/` 文件夹中，每个地图对应一个JSON文件。

## 战斗系统

战斗采用回合制，主要功能包括：
- 角色和敌人的属性管理（生命值、攻击力、防御力等）
- 攻击、防御等战斗指令
- 战斗结果判定（胜利、失败条件）
- 战斗动画效果和音效

## 技术实现细节

### 移动与坐标系统
- **8步移动**：每个瓦片格子的移动被分解为8个小步骤，实现平滑动画效果
- **坐标计算**：窗口标题栏显示的坐标基于角色所在的瓦片格子，而非像素位置
- **状态管理**：使用moving_state、steps_remaining和just_completed_tile等变量精确控制移动状态

### 地图切换机制
- **切换条件**：仅当角色完全进入切换点瓦片（just_completed_tile=True）时触发地图切换
- **状态同步**：地图切换后立即更新窗口标题和角色位置信息
- **优先级处理**：地图切换操作优先于遇敌判定，避免在切换点遇敌

### 遇敌系统优化
- **顺序控制**：先检测地图切换，再进行遇敌判定
- **切换点豁免**：位于地图切换点的瓦片不会触发遇敌
- **概率计算**：基于随机数和地图配置的遇敌概率系统

## 扩展建议

1. 添加更多地图和城镇，丰富游戏世界
2. 实现角色属性系统（等级、经验、装备等）
3. 增加战车系统，支持战车战斗和自定义
4. 实现剧情对话系统，推进游戏故事
5. 添加任务系统，提供游戏目标和奖励
6. 完善战斗系统，增加更多技能和战斗机制
7. 添加存档和读档功能，支持游戏进度保存

## 注意事项

1. 游戏需要Pygame库支持，请确保已安装
2. 图片资源主要位于 `assets/images/` 文件夹中
3. 地图数据使用JSON格式存储，可使用文本编辑器或地图编辑器修改
4. 音频资源包括背景音乐和音效，位于 `assets/audio/` 和 `assets/sounds/` 文件夹中
5. 游戏主程序为 `game.py`，旧版 `main.py` 已废弃
6. 备份文件位于 `back/` 文件夹中，可用于恢复之前的版本
